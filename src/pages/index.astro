---
import Base from '../layouts/Base.astro';
import { calculerSalaireNet } from '../lib/salaire.js';
import salaryData from '../data/salaryData.json';
import financialTips from '../data/financialTips.json';
import advancedDeductions from '../data/advancedDeductions.json';
---

<Base 
  title="Calculateur Salaire Net QuÃ©bec 2025 | Simulation ComplÃ¨te et PersonnalisÃ©e"
  description="Le calculateur de salaire le plus complet du QuÃ©bec. Calcul en temps rÃ©el, conseils personnalisÃ©s, comparaisons sociales et options avancÃ©es. DÃ©couvrez votre vrai net !"
>

<header class="bg-gradient-to-br from-emerald-50 via-white to-blue-50 border-b border-gray-100 shadow-sm sticky top-0 z-50 backdrop-blur-sm">
  <div class="max-w-6xl mx-auto px-4 py-4">
    <div class="flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-blue-500 rounded-lg flex items-center justify-center">
          <span class="text-white font-bold text-xl">ğŸ’°</span>
        </div>
        <h1 class="text-xl md:text-2xl font-bold bg-gradient-to-r from-emerald-600 to-blue-600 bg-clip-text text-transparent">
          SalaireNet.ca
        </h1>
      </div>
      
      <!-- Province Toggle -->
      <div class="flex items-center space-x-2 bg-white rounded-full p-1 shadow-sm border border-gray-200">
        <button id="toggle-qc" class="province-toggle active px-3 md:px-4 py-2 rounded-full text-xs md:text-sm font-medium transition-all duration-200">
          ğŸ QuÃ©bec
        </button>
        <button id="toggle-on" class="province-toggle px-3 md:px-4 py-2 rounded-full text-xs md:text-sm font-medium transition-all duration-200">
          ğŸ¢ Ontario  
        </button>
      </div>
    </div>
  </div>
</header>

<main class="min-h-screen bg-gradient-to-br from-emerald-50 via-white to-blue-50">
  
  <!-- Hero Section -->
  <section class="max-w-7xl mx-auto px-4 py-6 md:py-8">
    
    <div class="text-center mb-6 md:mb-8">
      <h2 class="text-3xl md:text-5xl font-bold text-gray-900 mb-4">
        Calculateur Salaire Net
        <span class="block text-emerald-600" id="province-title">QuÃ©bec 2025</span>
      </h2>
      <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto" id="hero-subtitle">
        Le calculateur le plus complet du QuÃ©bec avec conseils personnalisÃ©s
      </p>
    </div>

    <!-- Quick Presets -->
    <div class="flex flex-wrap justify-center gap-2 md:gap-3 mb-6 md:mb-8">
      <button class="preset-btn" data-salary="45000" data-type="salarie">
        ğŸ‘¨â€ğŸ’» Dev Junior <span class="block text-xs opacity-75">45k$</span>
      </button>
      <button class="preset-btn" data-salary="75000" data-type="salarie">
        ğŸ‘¨â€ğŸ’¼ Dev Senior <span class="block text-xs opacity-75">75k$</span>
      </button>
      <button class="preset-btn" data-salary="95000" data-type="salarie">
        ğŸš€ Lead Tech <span class="block text-xs opacity-75">95k$</span>
      </button>
      <button class="preset-btn" data-salary="60000" data-type="freelance">
        ğŸ’¼ Freelance <span class="block text-xs opacity-75">60k$</span>
      </button>
    </div>

    <div class="grid lg:grid-cols-3 gap-6 md:gap-8">
      
      <!-- Main Calculator -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
          
          <!-- Calculator Header -->
          <div class="bg-gradient-to-r from-emerald-500 to-blue-500 p-4 md:p-6 text-white">
            <h3 class="text-xl md:text-2xl font-bold mb-2">âš¡ Calcul en temps rÃ©el</h3>
            <p class="text-emerald-100">Saisissez votre salaire pour un calcul instantanÃ©</p>
          </div>

          <div class="p-4 md:p-6">
            
            <!-- Main Inputs -->
            <div class="grid md:grid-cols-2 gap-4 md:gap-6 mb-6">
              
              <!-- Salary Input -->
              <div class="space-y-3">
                <label class="block text-gray-700 font-semibold">ğŸ’° Salaire annuel brut</label>
                <div class="relative">
                  <input 
                    type="number" 
                    id="salary-input" 
                    class="w-full p-3 md:p-4 text-lg md:text-xl font-bold border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:ring-0 transition-colors"
                    placeholder="65000"
                    min="20000"
                    max="500000"
                  />
                  <span class="absolute right-3 md:right-4 top-1/2 transform -translate-y-1/2 text-gray-400 font-medium">CAD $</span>
                </div>
                
                <!-- Visual Slider -->
                <div class="mt-3">
                  <input 
                    type="range" 
                    id="salary-slider" 
                    min="20000" 
                    max="200000" 
                    step="1000"
                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                  />
                  <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>20k$</span>
                    <span>200k$</span>
                  </div>
                </div>
              </div>

              <!-- Status & Hours -->
              <div class="space-y-3">
                <label class="block text-gray-700 font-semibold">ğŸ‘¤ Votre statut</label>
                <div class="grid grid-cols-2 gap-2 p-1 bg-gray-100 rounded-xl">
                  <button id="status-employee" class="status-btn active py-2 md:py-3 px-3 md:px-4 rounded-lg text-sm font-medium transition-all duration-200">
                    ğŸ’¼ SalariÃ©
                  </button>
                  <button id="status-freelance" class="status-btn py-2 md:py-3 px-3 md:px-4 rounded-lg text-sm font-medium transition-all duration-200">
                    ğŸš€ Freelance
                  </button>
                </div>
                
                <div>
                  <label class="block text-gray-600 text-sm font-medium mb-2">â° Heures/semaine</label>
                  <input 
                    type="number" 
                    id="hours-input" 
                    value="35" 
                    min="20" 
                    max="60"
                    class="w-full p-3 border border-gray-200 rounded-lg focus:border-emerald-500 focus:ring-0"
                  />
                </div>
              </div>
            </div>

            <!-- Results Section -->
            <div id="results-container" class="hidden space-y-6">
              
              <!-- Main Net Result -->
              <div class="bg-gradient-to-r from-emerald-50 to-blue-50 rounded-2xl p-4 md:p-6 border border-emerald-200">
                <div class="text-center">
                  <p class="text-gray-600 mb-2">Votre salaire net annuel</p>
                  <div class="text-3xl md:text-4xl font-bold text-emerald-600 mb-1" id="net-annual">-</div>
                  <p class="text-gray-500">soit <span id="net-monthly" class="font-semibold text-gray-700">-</span> par mois</p>
                </div>
              </div>

              <!-- Accounting Style Breakdown -->
              <div class="bg-gray-50 rounded-2xl p-4 md:p-6 border border-gray-200">
                <h4 class="font-bold text-gray-800 text-lg mb-4">ğŸ“Š DÃ©composition comptable</h4>
                
                <div class="space-y-2 font-mono text-sm md:text-base">
                  <div class="flex justify-between items-center py-2 border-b border-gray-200">
                    <span class="text-gray-700">ğŸ’° Salaire brut annuel :</span>
                    <span class="font-bold text-gray-900" id="breakdown-gross">-</span>
                  </div>
                  <div class="flex justify-between items-center py-1">
                    <span class="text-red-600">â– ImpÃ´t fÃ©dÃ©ral :</span>
                    <span class="font-semibold text-red-600" id="breakdown-federal">-</span>
                  </div>
                  <div class="flex justify-between items-center py-1">
                    <span class="text-blue-600" id="breakdown-provincial-label">â– ImpÃ´t provincial (QC) :</span>
                    <span class="font-semibold text-blue-600" id="breakdown-provincial">-</span>
                  </div>
                  <div class="flex justify-between items-center py-1">
                    <span class="text-purple-600">â– RRQ :</span>
                    <span class="font-semibold text-purple-600" id="breakdown-rrq">-</span>
                  </div>
                  <div class="flex justify-between items-center py-1">
                    <span class="text-orange-600">â– RQAP :</span>
                    <span class="font-semibold text-orange-600" id="breakdown-rqap">-</span>
                  </div>
                  <div class="flex justify-between items-center py-1" id="breakdown-ae-row">
                    <span class="text-gray-600">â– Assurance-emploi :</span>
                    <span class="font-semibold text-gray-600" id="breakdown-ae">-</span>
                  </div>
                  
                  <div class="flex justify-between items-center py-3 border-t-2 border-gray-400 font-bold text-lg">
                    <span class="text-emerald-700">âœ… SALAIRE NET ANNUEL :</span>
                    <span class="text-emerald-600" id="breakdown-net">-</span>
                  </div>
                </div>
              </div>

              <!-- Time Breakdown -->
              <div class="bg-white rounded-2xl p-4 md:p-6 border border-gray-200">
                <h4 class="font-bold text-gray-800 text-lg mb-4">ğŸ—“ï¸ RÃ©partition temporelle</h4>
                
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                  <div class="text-center p-3 bg-emerald-50 rounded-lg">
                    <div class="text-xs text-emerald-600 mb-1">Mensuel</div>
                    <div class="font-bold text-emerald-700" id="time-monthly">-</div>
                  </div>
                  <div class="text-center p-3 bg-blue-50 rounded-lg">
                    <div class="text-xs text-blue-600 mb-1">Bi-mensuel</div>
                    <div class="font-bold text-blue-700" id="time-bimonthly">-</div>
                  </div>
                  <div class="text-center p-3 bg-purple-50 rounded-lg">
                    <div class="text-xs text-purple-600 mb-1">Semaine</div>
                    <div class="font-bold text-purple-700" id="time-weekly">-</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Sidebar -->
      <div class="space-y-4 md:space-y-6">
        
        <!-- Social Comparison -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-4 md:p-6">
          <h3 class="font-bold text-gray-800 mb-4 flex items-center">
            <span class="mr-2">ğŸ¯</span> Votre position sociale
          </h3>
          <div id="social-comparison" class="space-y-3 text-sm">
            <p class="text-gray-600">Saisissez votre salaire pour voir votre position</p>
          </div>
        </div>

        <!-- Financial Recommendations -->
        <div class="bg-gradient-to-br from-emerald-50 to-blue-50 rounded-2xl shadow-lg border border-emerald-200 p-4 md:p-6">
          <h3 class="font-bold text-emerald-800 mb-4 flex items-center">
            <span class="mr-2">ğŸ’¡</span> Conseils personnalisÃ©s
          </h3>
          <div id="financial-tips" class="space-y-3 text-sm">
            <p class="text-emerald-700">Des conseils adaptÃ©s Ã  votre situation apparaÃ®tront ici</p>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- CSS styles (inchangÃ©) -->
<style>
  /* Tous tes styles CSS existants */
  .slider::-webkit-slider-thumb {
    appearance: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(135deg, #10b981, #3b82f6);
    cursor: pointer;
    border: 3px solid white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  .province-toggle.active {
    background: linear-gradient(135deg, #10b981, #3b82f6);
    color: white;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
  }

  .status-btn.active {
    background: linear-gradient(135deg, #10b981, #3b82f6);
    color: white;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
  }

  .preset-btn {
    @apply bg-white hover:bg-emerald-50 border border-emerald-200 hover:border-emerald-300 rounded-xl px-3 md:px-4 py-2 md:py-3 text-xs md:text-sm font-medium text-emerald-700 transition-all duration-200 hover:shadow-md;
  }
</style>

<script define:vars={{ salaryData, financialTips, advancedDeductions }}>
console.log('ğŸš€ Script chargÃ© !', { salaryData, financialTips, advancedDeductions });

// ğŸ†• RECREER LA FONCTION CALCUL CÃ”TÃ‰ CLIENT
function calculerSalaireNet(salaire, statut = 'salarie') {
  console.log('ğŸ”¢ Calcul cÃ´tÃ© client:', salaire, statut);
  
  const isFreelance = statut === 'freelance';
  
  // RRQ
  const rrqRate = isFreelance ? 0.128 : 0.064;
  const rrq = Math.min(Math.max(0, salaire - 3500), 71200 - 3500) * rrqRate;
  
  // RQAP & AE
  const rqap = Math.min(salaire, 98000) * (isFreelance ? 0.00878 : 0.00494);
  const ae = isFreelance ? 0 : Math.min(salaire, 65700) * 0.0131;

  // ImpÃ´t fÃ©dÃ©ral
  const fed = calculerPalier(salaire, [
    { limit: 57375, rate: 0.15 },
    { limit: 114750, rate: 0.205 },
    { limit: 177882, rate: 0.26 },
    { limit: 253414, rate: 0.29 },
    { limit: Infinity, rate: 0.33 }
  ]);

  // ImpÃ´t provincial
  const prov = calculerPalier(salaire, [
    { limit: 53255, rate: 0.14 },
    { limit: 106495, rate: 0.19 },
    { limit: 129590, rate: 0.24 },
    { limit: Infinity, rate: 0.2575 }
  ]);

  const total = rrq + rqap + ae + fed + prov;
  
  return {
    net: Math.round(salaire - total),
    rrq: Math.round(rrq),
    rqap: Math.round(rqap),
    ae: Math.round(ae),
    fed: Math.round(fed),
    prov: Math.round(prov)
  };
}

function calculerPalier(income, brackets) {
  let tax = 0, prev = 0;
  for (const b of brackets) {
    const taxable = Math.min(income, b.limit) - prev;
    if (taxable > 0) {
      tax += taxable * b.rate;
      prev = b.limit;
    } else break;
  }
  return tax;
}

class SalaryCalculator {
  constructor() {
    this.currentProvince = 'QC';
    this.currentStatus = 'salarie';
    this.currentSalary = 0;
    console.log('âœ… Calculator initialisÃ©');
    this.initEventListeners();
    
    // Test avec 65000$ au dÃ©marrage
    setTimeout(() => {
      this.calculateSalary(65000);
      document.getElementById('salary-input').value = 65000;
      document.getElementById('salary-slider').value = 65000;
    }, 500);
  }

  initEventListeners() {
    console.log('ğŸ”— Ajout des event listeners...');
    
    // Province toggles
    document.getElementById('toggle-qc')?.addEventListener('click', () => this.switchProvince('QC'));
    document.getElementById('toggle-on')?.addEventListener('click', () => this.switchProvince('ON'));

    // Status toggles  
    document.getElementById('status-employee')?.addEventListener('click', () => this.switchStatus('salarie'));
    document.getElementById('status-freelance')?.addEventListener('click', () => this.switchStatus('freelance'));

    // Salary inputs
    const salaryInput = document.getElementById('salary-input');
    const salarySlider = document.getElementById('salary-slider');
    
    salaryInput?.addEventListener('input', (e) => {
      const value = parseFloat(e.target.value) || 0;
      if (salarySlider) salarySlider.value = Math.min(value, 200000);
      this.calculateSalary(value);
    });
    
    salarySlider?.addEventListener('input', (e) => {
      const value = parseFloat(e.target.value);
      if (salaryInput) salaryInput.value = value;
      this.calculateSalary(value);
    });

    // Preset buttons
    document.querySelectorAll('.preset-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const salary = parseInt(btn.dataset.salary);
        const type = btn.dataset.type;
        console.log('ğŸ¯ Preset cliquÃ©:', salary, type);
        
        if (salaryInput) salaryInput.value = salary;
        if (salarySlider) salarySlider.value = salary;
        this.switchStatus(type);
        this.calculateSalary(salary);
      });
    });
  }

  switchProvince(province) {
    console.log('ğŸ—ºï¸ Switch province:', province);
    this.currentProvince = province;
    
    document.querySelectorAll('.province-toggle').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`toggle-${province.toLowerCase()}`).classList.add('active');
    
    // Update labels
    const labels = {
      QC: { title: 'QuÃ©bec 2025', provincial: 'â– ImpÃ´t QuÃ©bec :' },
      ON: { title: 'Ontario 2025', provincial: 'â– ImpÃ´t Ontario :' }
    };
    
    document.getElementById('province-title').textContent = labels[province].title;
    document.getElementById('breakdown-provincial-label').textContent = labels[province].provincial;
    
    this.calculateSalary(this.currentSalary);
  }

  switchStatus(status) {
    console.log('ğŸ‘¤ Switch status:', status);
    this.currentStatus = status;
    
    document.querySelectorAll('.status-btn').forEach(btn => btn.classList.remove('active'));
    const targetBtn = status === 'salarie' ? 'status-employee' : 'status-freelance';
    document.getElementById(targetBtn).classList.add('active');
    
    this.calculateSalary(this.currentSalary);
  }

  calculateSalary(grossSalary) {
    if (!grossSalary || grossSalary <= 0) {
      console.log('âŒ Pas de salaire Ã  calculer');
      document.getElementById('results-container').classList.add('hidden');
      return;
    }

    console.log('ğŸ”¢ Calcul pour:', grossSalary, this.currentStatus);
    this.currentSalary = grossSalary;
    
    // âœ… MAINTENANT Ã‡A VA MARCHER !
    const result = calculerSalaireNet(grossSalary, this.currentStatus);
    console.log('ğŸ“Š RÃ©sultat:', result);
    
    // Show results
    const container = document.getElementById('results-container');
    if (container) {
      container.classList.remove('hidden');
      this.updateResults(result);
      this.updateTimeBreakdown(result.net);
      this.updateSocialComparison(result.net);
      this.updateFinancialTips(result.net);
    }
  }

  updateResults(result) {
    console.log('ğŸ“ Mise Ã  jour des rÃ©sultats:', result);
    
    const formatCurrency = (amount) => 
      new Intl.NumberFormat('fr-CA', { 
        style: 'currency', 
        currency: 'CAD',
        maximumFractionDigits: 0 
      }).format(amount);

    // Main results
    document.getElementById('net-annual').textContent = formatCurrency(result.net);
    document.getElementById('net-monthly').textContent = formatCurrency(result.net / 12);

    // Breakdown
    document.getElementById('breakdown-gross').textContent = formatCurrency(this.currentSalary);
    document.getElementById('breakdown-federal').textContent = `-${formatCurrency(result.fed)}`;
    document.getElementById('breakdown-provincial').textContent = `-${formatCurrency(result.prov)}`;
    document.getElementById('breakdown-rrq').textContent = `-${formatCurrency(result.rrq)}`;
    document.getElementById('breakdown-rqap').textContent = `-${formatCurrency(result.rqap)}`;
    document.getElementById('breakdown-ae').textContent = `-${formatCurrency(result.ae)}`;
    document.getElementById('breakdown-net').textContent = formatCurrency(result.net);

    // Hide AE for freelancers
    const aeRow = document.getElementById('breakdown-ae-row');
    if (this.currentStatus === 'freelance') {
      aeRow.classList.add('hidden');
    } else {
      aeRow.classList.remove('hidden');
    }
  }

  updateTimeBreakdown(netAnnual) {
    const formatCurrency = (amount) => 
      new Intl.NumberFormat('fr-CA', { 
        style: 'currency', 
        currency: 'CAD',
        maximumFractionDigits: 0 
      }).format(amount);

    const monthly = netAnnual / 12;
    const bimonthly = monthly / 2;
    const weekly = netAnnual / 52;

    document.getElementById('time-monthly').textContent = formatCurrency(monthly);
    document.getElementById('time-bimonthly').textContent = formatCurrency(bimonthly);
    document.getElementById('time-weekly').textContent = formatCurrency(weekly);
  }

// ğŸ†• POSITION SOCIALE CORRIGÃ‰E
updateSocialComparison(netSalary) {
  const container = document.getElementById('social-comparison');
  
  // Convertir le net en brut approximatif pour comparaison
  const approximateGross = Math.round(netSalary / 0.68); // Assume ~32% dÃ©ductions
  
  console.log('ğŸ¯ Comparaison:', { netSalary, approximateGross });
  
  // Trouver des jobs similaires au BRUT approximatif
  const similarJobs = salaryData.jobComparisons
    .filter(job => Math.abs(job.salary - approximateGross) < 25000)
    .sort((a, b) => Math.abs(a.salary - approximateGross) - Math.abs(b.salary - approximateGross))
    .slice(0, 3);

  // Trouver le percentile basÃ© sur le brut approximatif
  const percentile = salaryData.percentileRanges.find(range => 
    approximateGross >= range.minSalary && approximateGross < range.maxSalary
  );

  // Calculer la position relative
  let betterThan = 50; // Default
  if (approximateGross < 35000) betterThan = 15;
  else if (approximateGross < 50000) betterThan = 35;
  else if (approximateGross < 65000) betterThan = 55;
  else if (approximateGross < 80000) betterThan = 75;
  else if (approximateGross < 100000) betterThan = 85;
  else betterThan = 90;

  const html = `
    <div class="space-y-3">
      <div class="p-3 bg-emerald-50 rounded-lg border border-emerald-200">
        <div class="text-sm font-medium text-emerald-700">Votre position :</div>
        <div class="font-bold text-emerald-600">${percentile?.percentile || 'Top 10%'}</div>
        <div class="text-xs text-emerald-600 mt-1">
          Mieux que <strong>${betterThan}%</strong> des QuÃ©bÃ©cois
        </div>
      </div>
      
      ${similarJobs.length > 0 ? `
        <div class="space-y-2">
          <div class="text-xs font-medium text-gray-700">Salaires similaires (brut) :</div>
          ${similarJobs.map(job => `
            <div class="flex items-center justify-between text-xs p-2 bg-gray-50 rounded">
              <span class="flex items-center">
                <span class="mr-2">${job.emoji}</span>
                <span>${job.title}</span>
              </span>
              <span class="font-medium text-gray-700">${this.formatCurrency(job.salary)}</span>
            </div>
          `).join('')}
        </div>
      ` : `
        <div class="text-xs text-gray-600 p-2 bg-gray-50 rounded">
          ğŸ¯ Votre salaire est dans une catÃ©gorie unique ! Excellent niveau.
        </div>
      `}
      
      <!-- Indications de niveau -->
      <div class="text-xs text-center p-2 rounded ${
        approximateGross > 80000 ? 'bg-green-50 text-green-700' :
        approximateGross > 60000 ? 'bg-blue-50 text-blue-700' :
        approximateGross > 45000 ? 'bg-orange-50 text-orange-700' :
        'bg-amber-50 text-amber-700'
      }">
        ${approximateGross > 80000 ? 'ğŸŒŸ Excellent salaire ! Vous Ãªtes dans le top 20%' :
          approximateGross > 60000 ? 'ğŸ‘ Bon salaire, au-dessus de la moyenne quÃ©bÃ©coise' :
          approximateGross > 45000 ? 'ğŸ“ˆ Salaire correct, place Ã  l\'amÃ©lioration' :
          'ğŸ’ª Salaire d\'entrÃ©e, concentrez-vous sur l\'Ã©volution'}
      </div>
    </div>
  `;

  container.innerHTML = html;
}

updateFinancialTips(netSalary) {
  const container = document.getElementById('financial-tips');
  const monthlyNet = netSalary / 12;
  
  // Calculs budgÃ©taires intelligents
  const budgetBreakdown = {
    housing: Math.round(monthlyNet * 0.30), // 30% logement
    transport: Math.round(monthlyNet * 0.15), // 15% transport  
    food: Math.round(monthlyNet * 0.12), // 12% alimentation
    debtMax: Math.round(monthlyNet * 0.20), // 20% dettes max
    savings: Math.round(monthlyNet * 0.10), // 10% Ã©pargne min
    fun: Math.round(monthlyNet * 0.13) // 13% loisirs/divers
  };
  
  // Recommandations d'Ã©pargne
  const recommendation = financialTips.savingsRecommendations.find(rec => 
    netSalary >= rec.minSalary && netSalary <= rec.maxSalary
  ) || financialTips.savingsRecommendations[0];

  // Alertes intelligentes basÃ©es sur le salaire
  const alerts = [];
  if (monthlyNet < 3000) {
    alerts.push({
      icon: 'âš ï¸',
      text: 'Ã‰vitez les dettes de consommation, concentrez-vous sur l\'Ã©pargne d\'urgence',
      color: 'amber'
    });
  }
  if (monthlyNet > 6000) {
    alerts.push({
      icon: 'ğŸ¯',
      text: 'Excellent niveau ! Maximisez vos REER pour rÃ©duire vos impÃ´ts',
      color: 'green'
    });
  }
  if (budgetBreakdown.housing > 2000) {
    alerts.push({
      icon: 'ğŸ ',
      text: `Logement > 2000$/mois ? ConsidÃ©rez la banlieue ou la colocation`,
      color: 'blue'
    });
  }

  const html = `
    <div class="space-y-4">
      <!-- Budget dÃ©taillÃ© -->
      <div class="bg-white rounded-lg p-3 border border-emerald-100">
        <div class="text-sm font-semibold text-emerald-800 mb-3">ğŸ’° Budget mensuel recommandÃ©</div>
        <div class="grid grid-cols-2 gap-2 text-xs">
          <div class="flex justify-between">
            <span class="text-gray-600">ğŸ  Logement max :</span>
            <span class="font-semibold text-emerald-700">${this.formatCurrency(budgetBreakdown.housing)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ğŸš— Transport max :</span>
            <span class="font-semibold text-blue-700">${this.formatCurrency(budgetBreakdown.transport)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ğŸ›’ Alimentation :</span>
            <span class="font-semibold text-purple-700">${this.formatCurrency(budgetBreakdown.food)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ğŸ’³ Dettes MAX :</span>
            <span class="font-semibold text-red-700">${this.formatCurrency(budgetBreakdown.debtMax)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ğŸ’¾ Ã‰pargne min :</span>
            <span class="font-semibold text-green-700">${this.formatCurrency(budgetBreakdown.savings)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ğŸ® Loisirs :</span>
            <span class="font-semibold text-orange-700">${this.formatCurrency(budgetBreakdown.fun)}</span>
          </div>
        </div>
      </div>

      <!-- Ã‰pargne recommandÃ©e -->
      <div class="grid grid-cols-3 gap-2 text-xs">
        <div class="text-center p-2 bg-blue-50 rounded">
          <div class="font-semibold text-blue-700">CELIAPP</div>
          <div class="text-blue-600">${this.formatCurrency(recommendation.celiapp)}/mois</div>
        </div>
        <div class="text-center p-2 bg-purple-50 rounded">
          <div class="font-semibold text-purple-700">REER</div>
          <div class="text-purple-600">${this.formatCurrency(recommendation.rrsp)}/mois</div>
        </div>
        <div class="text-center p-2 bg-green-50 rounded">
          <div class="font-semibold text-green-700">CELI</div>
          <div class="text-green-600">${this.formatCurrency(recommendation.tfsa)}/mois</div>
        </div>
      </div>
      
      <!-- Alertes intelligentes -->
      ${alerts.length > 0 ? `
        <div class="space-y-2">
          ${alerts.map(alert => `
            <div class="flex items-start text-xs p-2 bg-${alert.color}-50 rounded border border-${alert.color}-200">
              <span class="mr-2 mt-0.5">${alert.icon}</span>
              <span class="text-${alert.color}-700">${alert.text}</span>
            </div>
          `).join('')}
        </div>
      ` : ''}
      
      <!-- Conseils personnalisÃ©s -->
      <div class="space-y-2">
        ${recommendation.tips.map(tip => `
          <div class="flex items-start text-xs">
            <span class="text-emerald-500 mr-2 mt-0.5">âœ“</span>
            <span class="text-emerald-700">${tip}</span>
          </div>
        `).join('')}
      </div>
      
      <!-- RÃ¨gles importantes -->
      <div class="pt-2 border-t border-emerald-200 space-y-1">
        <div class="text-xs text-emerald-600">
          ğŸ’¡ <strong>RÃ¨gle d'or :</strong> Ne jamais dÃ©passer ${this.formatCurrency(budgetBreakdown.debtMax)}/mois en dettes
        </div>
        <div class="text-xs text-emerald-600">
          ğŸ›¡ï¸ <strong>Fonds d'urgence :</strong> ${this.formatCurrency(monthlyNet * 6)} (6 mois d'expenses)
        </div>
      </div>
    </div>
  `;

  container.innerHTML = html;
}

  formatCurrency(amount) {
    return new Intl.NumberFormat('fr-CA', {
      style: 'currency',
      currency: 'CAD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(amount).replace('CA', '').trim();
  }
}

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
  console.log('ğŸ¬ DOM chargÃ©, initialisation...');
  new SalaryCalculator();
});
</script>

</Base>